<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>示例demo</title>
    <link rel="stylesheet" href="layui/css/layui.css">
</head>
<body style="width: 200%;">
<table class="layui-hide" id="tableId" lay-filter="tableEvent"></table>
</body>
<script src="layui/layui.js"></script>
<script>
    layui.config({
        base: 'module/'
    }).extend({
        tableEdit:'js/tableEdit'
        //tableEdit:'js/column-tableEdit/tableEdit'
        /**
         * 第一个js的下拉框div在body中创建
         * 第二个js的下拉框div在单元格中创建
         * 两个js用法一致，具体用哪个js看个人喜好。
         */
    }).use(['table','tableEdit','layer'], function () {
        var table = layui.table,tableEdit = layui.tableEdit,$ = layui.$;
        var params = [
            {name:1,value:"张三1"},
            {name:2,value:"张三2"},
            {name:3,value:"张三3"},
            {name:4,value:"张三4"},
            {name:5,value:"张三5"}
        ];
        var cols = table.render({
            elem: '#tableId'
            ,id:'id'
            ,url:'data.json'
            ,height: 'full-90'
            ,page: true
            ,cols: [[
                {type:'checkbox'}
                ,{field:'name',title: '姓名',width:120}
                //select（下拉框）date（时间选择框）
                ,{field:'danxuan',align:'center', title: '单选',width:120,event:'danxuan',select:{data:params}}
                //data 为下拉框数据  enabled => true：多选，false：单选。默认为false
                ,{field:'duoxuan',align:'center', title: '多选',width:120,event:'duoxuan',select:{data:params,enabled:true,isRemove:true}}
                //dateType表示日期时间格式，date为“yyyy-MM-dd”，datetime为“yyyy-MM-dd HH:ss:mm”
                ,{field:'birthday', title: '生日',width:120,event:'birthday',date:{dateType:'date'}}
                //cascadeSelectField字段为级联开关字段(存在该字段则级联，否则不级联)
                ,{field:'xlkjl', title: '下拉框联动(上级)',width:150,event:'xlkjl',select:{data:params,cascadeSelectField:'xialaxiaji'}}
                ,{field:'xialaxiaji', title: '下拉框联动(下级)',width:150,event:'xiaji',select:{data:params}}
                ,{field:'rqjl', title: '日期联动(上级)',width:150,event:'rqjl',date:{dateType:'date',cascadeSelectField:'rqxiaji'}}
                ,{field:'rqxiaji', title: '日期框联动(下级)',width:150,event:'rqxiaji',select:{data:params}}
            ]],done:function () {
                /**
                 * 单元格显示输入框
                 * 如果不需要显示输入框，就不要调用此方法。
                 * 参数
                 * fields => 需要显示输入框的列，数组类。
                 * elemen => 表格id或者表格元素对象
                 **/
                tableEdit.callback('showInput',{fields:['danxuan'],element:'#tableId'})
            }
        }).config.cols;

        /**
         * 参数cols是table.render({})中的cols属性值
         * aop代理是基于event点击事件进行操作的，因此cols中务必开启event点击事件！
         **/
        var aopTable = tableEdit.aopObj(cols); //获取一个aop对象
        /**
         * 注意：
         * 1、 aopTable.on('tool(xxx)',function (obj) {})
         * 2、 table.on('tool(yyy)',function (obj) {})
         * 如果1中的xxx与2中的yyy字符串相同时，不能同时用，用了会造成后调用者覆盖前调用者。
         * 应该直接用1来代替2，因为1中包含了2中的事件。
         * 如果不相同，则可以同时使用。
         **/
        aopTable.on('tool(tableEvent)',function (obj) {
            var field = $(this).data('field');
            console.log(obj);
            var thisValue = obj.value;
            if(thisValue){
                thisValue = Array.isArray(thisValue) ? thisValue[0] : thisValue;
            }
            var update = {};
            update[field] = thisValue && typeof thisValue === 'string' ? thisValue : thisValue.value;
            //把value更新到行中
            obj.update(update);
            //把显示值更新到输入框中(input)
            thisValue && typeof thisValue === 'string' ? null : $(this).find('input.layui-tableEdit-input').val(thisValue.value);
        });


        /**
         * 级联下拉框 => 点击事件生成下拉框之前的回调函数
         * 主要用于 => 动态获取单元格下拉数据
         * tableEvent => table的lay-filter属性值
         * 如示例代码所示
         */
        tableEdit.on('clickBefore(tableEvent)',function () {
            var cascadeSelectData = $(this).attr("cascadeSelect-data"); //级联数据
            var cascadeSelectField = $(this).attr("cascadeSelect-field"); //级联字段
            cascadeSelectData = JSON.parse(cascadeSelectData);
            if(Array.isArray(cascadeSelectData)){
                cascadeSelectData = cascadeSelectData[0];
            }
            //下拉数据 只可ajax同步请求后台
            if(cascadeSelectField === 'rqjl'){ //日期级联下拉框
                if(cascadeSelectData === '2020-05-11'){
                    aopTable.cascadeSelectConfig = {
                        data:[{name:1,value:'语文'},{name:2,value:'数学'},{name:3,value:'英语'},{name:4,value:'物理'},{name:5,value:'化学'}],
                        enabled:false //单选
                    };
                }else {
                    aopTable.cascadeSelectConfig = {
                        data:[{name:6,value:'政治'},{name:7,value:'地理'},{name:8,value:'历史'},{name:9,value:'生物'},{name:10,value:'音乐'}],
                        enabled:true //多选
                    };
                }
            }else {
                if(cascadeSelectData.name+'' === '1'){
                    aopTable.cascadeSelectConfig = {
                        data:[{name:11,value:'贵州'},{name:12,value:'云南'},{name:13,value:'四川'},{name:14,value:'湖南'}],
                        enabled:false //单选
                    };
                }else {
                    aopTable.cascadeSelectConfig = {
                        data:[{name:15,value:'荆州'},{name:16,value:'扬州'},{name:17,value:'杭州'},{name:18,value:'苏州'}],
                        enabled:true //多选
                    };
                }
            }
        });
        /**
         * 下拉框删除之后执行的回调
         **/
        tableEdit.on('deleteAfter(tableEvent)',function () {
            /**
             * 删除单元格输入框
             * 如果不需要删除输入框，就不要调用此方法。
             * 参数
             * fields => 需要显示删除的输入框的列，数组类。
             * elemen => 表格id或者表格元素对象
             **/
            tableEdit.callback('hideInput',{fields:['duoxuan','xlkjl','xialaxiaji','rqxiaji'],element:'#tableId'});
        });
    });
</script>
</html>